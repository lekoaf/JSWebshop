<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=450,maximum-scale=1" />
	<title>Webshop test</title>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="material/css-compiled/ripples.min.css" rel="stylesheet">
	<link href="material/css-compiled/material-wfont.min.css" rel="stylesheet">
	<style>
	#bg {
	  position: fixed; 
	  top: 0; 
	  left: 0; 
		
	  /* Preserve aspect ratio */
	  min-width: 100%;
	  min-height: 100%;
	}
	.container {
		margin-top: 10px;
		margin-bottom: 10px;
	}
	.badge-danger {
		background-color: #d9534f !important;
	}
	.badge-primary {
		background-color: #428bca !important;
	}
	th[data-sort] {
      cursor:pointer;
    }
    .ppad {
    	padding: 10px;
    }
	</style>
</head>
<body>
<img src="img/bg3.jpg" id="bg" alt="">
<div class="container">
<div class="row">
	<div class="col-md-12 header">
		<img src="img/header-mana1.jpg" width="100%"/>
	</div>
	<div class="col-md-12">
		<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Webshop</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-list"></i> Categories <span class="caret"></span></a>
          <ul class="dropdown-menu categories" role="menu">
          	<!-- categories -->
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#" class="showbasket"><i class="fa fa-shopping-cart"></i> Basket <span class="badge basketicon">0</span></a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
	</div>
	<div class="col-md-8">
	<div class="items panel ppad">
		<p class="lead">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla lobortis vestibulum lorem, in tristique eros mollis non. Morbi vitae felis nulla. Aliquam id tincidunt magna, eu tempor ipsum. Sed quis nibh a leo porta rhoncus sed non nunc. Praesent quis pharetra orci, a varius urna.</p>
		<h3 class="thecat"></h3>
		<table class="table table-hover">
			<thead>
				<tr>
					<th data-sort="string">Description</th>
					<th>Number</th>
					<th data-sort="float">Price</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<!-- Webshop content -->
			</tbody>
		</table>
	</div>
</div>
<div class="col-md-4">
	<div class="panel ppad">
	<h4>Terms</h4>
	 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla lobortis vestibulum lorem, in tristique eros mollis non. Morbi vitae felis nulla. Aliquam id tincidunt magna, eu tempor ipsum. Sed quis nibh a leo porta rhoncus sed non nunc. Praesent quis pharetra orci, a varius urna. Vestibulum sollicitudin metus quis quam molestie viverra. Maecenas a finibus diam. 
	 <br/><br/>
	<h4>Conditions</h4>
	 Maecenas odio erat, venenatis a efficitur nec, iaculis id quam. Quisque pulvinar nisi eget placerat pulvinar. Nullam at imperdiet ex, sit amet tincidunt ipsum. Integer commodo dolor ex, eget rutrum arcu molestie ut.
	<br/><br/>
	<h4>Disclaimer</h4>
	Donec sed arcu sem. Pellentesque auctor commodo blandit. Vivamus ut justo varius, ornare ex id, malesuada erat. Vestibulum ultrices ante sit amet orci aliquam dapibus. Integer eget aliquet nunc.
</div>
<div class="panel ppad">
		<h4>Contact</h4>
		Company Name <br/>
		Street 1 </br>
		90 201 The City <br/>
		Phone: 000111222333<br/>
		Email: email@email.com
	</div>
</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="basketModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Basket <span class="badge basketicon">0</span></h4>
      </div>
      <div class="modal-body">
        <table class="table table-hover">
			<thead>
				<tr>
					<th data-sort="string">Description</th>
					<th>Number</th>
					<th data-sort="float">Price</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<!-- Webshop content -->
			</tbody>
		</table>

		<hr/>
		<h4>Order details</h4>
		<!-- Form -->
		<form class="form-horizontal" role="form" id="orderDetails">
		  <div class="form-group">
		    <label for="inFirst" class="col-sm-2 control-label">First name</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="inFirst" placeholder="First name" data-validate-as="string">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inLast" class="col-sm-2 control-label">Last name</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="inLast" placeholder="Last name" data-validate-as="string">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inStreet" class="col-sm-2 control-label">Street</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="inStreet" placeholder="Street" data-validate-as="string">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inZip" class="col-sm-2 control-label">Zip code</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="inZip" placeholder="Zip code" data-validate-as="number">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inCity" class="col-sm-2 control-label">City</label>
		    <div class="col-sm-10">
		      <input type="text" class="form-control" id="inCity" placeholder="City" data-validate-as="string">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inEmail" class="col-sm-2 control-label">Email</label>
		    <div class="col-sm-10">
		      <input type="email" class="form-control" id="inEmail" placeholder="Email" data-validate-as="email">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inPhone" class="col-sm-2 control-label">Phone</label>
		    <div class="col-sm-10">
		      <input type="tel" class="form-control" id="inPhone" placeholder="Phone" data-validate-as="number">
		    </div>
		  </div>
		</form>
		<!-- /Form -->

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary sendOrder">Send order</button>
      </div>
    </div>
  </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="js/webshop.js"></script>
<script src="js/stupidtable.min.js"></script>
<script src="js/formvalidate.js"></script>
<script>
$(document).ready(function(){

	// Stupid table jQuery plugin - http://joequery.github.io/Stupid-Table-Plugin/
	var table = $(".table").stupidtable({
	    // Sort functions here
	});

	table.bind('aftertablesort', function (event, data) {
	    // data.column - the index of the column sorted after a click
	    // data.direction - the sorting direction (either asc or desc)

	    var th = $(this).find("th");
	    th.find(".arrow").remove();
	    var arrow = data.direction === "asc" ? "<i class='fa fa-chevron-up'></i>" : "<i class='fa fa-chevron-down'></i>";
	    th.eq(data.column).append('<span class="arrow"> ' + arrow +'</span>');
	});

	// Perhaps some kind of quick templating with $.load()
	// http://api.jquery.com/load/

	function readJson(category){
		var ajaxOptions = {
	        processData: false,
	        dataType: 'json',
	        contentType: 'application/json',
	        success : getItemSuccess,
	        error : getItemError,
	        type: 'GET',
	    };

	    $.ajax('db/items.json', ajaxOptions);

	    function getItemSuccess(data, msg, jqxhr){
	    	SKWEBSHOP.setItems(data);

	    	SKWEBSHOP.setCategory(category);

	    	SKWEBSHOP.setTotal();
			var noOfItems = SKWEBSHOP.getTotalItems();
			$(".basketicon").html(noOfItems);
			
			$(".categories").html("");
			
			$.each(data, function (key, val){
				$(".categories").append("<li><a href='#' data-cat='"+key+"'><i class='fa fa-caret-right'></i> "+key.charAt(0).toUpperCase() + key.slice(1) +"</a></li>")
			});
			$(".thecat").html(category.charAt(0).toUpperCase() + category.slice(1));

			setCategory(category, data);
	    }

	    function getItemError(jqxhr, status, error){
	    	console.log("error");
	    	console.log(jqxhr);
	    	console.log(status);
	    	console.log(error);
	    }
	}

	function setCategory(category, data){
		$(".items tbody").html(function(){
			var shopHtml = "";

			$.each(data, function (key, val){
				if (key === category){
					
					var catObj = val;

					$.each(catObj, function (key, val){
						if (catObj[key].stock){
							shopHtml += "<tr>"+
							"<td>"+catObj[key].title+" <span class='badge badge-primary'>"+catObj[key].stock+"</span></td>"+
							"<td><input type='text' class='form-control' name='"+key+"' id='"+key+"' size='3' value='0'/></td>"+
							"<td>"+catObj[key].price.toFixed(2)+" kr	</td>"+
							"<td><button data-artno='"+key+"' class='btn btn-primary order'>Buy</button></td></tr>";
						} else {
							shopHtml += "<tr>"+
							"<td>"+catObj[key].title+" <span class='badge badge-danger'>"+catObj[key].stock+"</span></td>"+
							"<td><input type='text' class='form-control' name='"+key+"' id='"+key+"' size='3' value='0'/></td>"+
							"<td>"+catObj[key].price.toFixed(2)+" kr	</td>"+
							"<td><button data-artno='"+key+"' class='btn btn-primary disabled order'>Buy</button></td></tr>";
						}
					});
				}
			});
			return shopHtml;
		});
	}

	function showBasket(){
		$('#basketModal').modal();
		$(".modal-body tbody").html(function(){
    		var basketHtml = "";
    		var b = SKWEBSHOP.getBasket();
    		var totp = 0;

	    	$.each(b, function (key, val){
	    		var p = SKWEBSHOP.getItemInfo(val.cat, val.item);
	    		
	    		totp = totp + (p.price * val.no);

	    		basketHtml += "<tr>"+
				"<td>"+p.name+"</td>"+
				"<td><input type='text' class='form-control' name='"+val.item+"' id='id"+val.item+"' size='3' value='"+val.no+"'/></td>"+
				"<td>"+p.price.toFixed(2)+" kr</td>"+
				"<td><button data-artno='"+val.item+"' class='btn btn-primary orderupdate'>Update</button> <button class='btn btn-danger orderdelete' data-artno='"+val.item+"'>&times;</button></td></tr>";

	    	});

	    	return basketHtml;
    	});
	}

	$(document).on('click', '.sendOrder', function(){
    	validate('#orderDetails');
    });

	$(document).on('click', '.categories li', function (e){
		var theCategory = $(e.target).attr("data-cat");
		
		readJson(theCategory);
	});

    $(document).on('click', '.order', function (e){
    	
    	var artno = $(e.target).attr('data-artno');
    	var no = $("#"+artno).val();

    	if (no && no !== "0" && !isNaN(no)){
    		SKWEBSHOP.addToBasket(parseInt(no), artno);
    		SKWEBSHOP.setTotal();
    		SKWEBSHOP.talk();
    		$("#"+artno).val("0");
	    	$(".basketicon").html(SKWEBSHOP.getTotalItems());
    	}

    });

    $(document).on('click', '#next', function(){
    	showBasket();

    	// var ajaxOptions = {
	    //     processData: false,
	    //     dataType: 'json',
	    //     contentType: 'application/json',
	    //     success : sendOrderSuccess,
	    //     error : sendOrderError,
	    //     data: theData,
	    //     type: 'POST',
	    // };

    	// $.ajax('/send', ajaxOptions);

    });

    $(document).on('click', '.showbasket', function(){
    	showBasket();
    });

    $(document).on('click', '.orderupdate', function (e){
    	var artno = $(e.target).attr('data-artno');
    	console.log("artno: "+artno);
    	var no = $("#id"+artno).val();
    	console.log("no: "+no);
    	if (no && !isNaN(no)){
	    	SKWEBSHOP.updateBasketItem(parseInt(no), artno);
	    	SKWEBSHOP.setTotal();
		    $(".basketicon").html(SKWEBSHOP.getTotalItems());
		    showBasket();
		}
    });

    $(document).on('click', '.orderdelete', function (e){
    	var artno = $(e.target).attr('data-artno');
    	SKWEBSHOP.deleteFromBasket(artno);
    	SKWEBSHOP.setTotal();
    	$(".basketicon").html(SKWEBSHOP.getTotalItems());
    	showBasket();
    });

    readJson(SKWEBSHOP.getDefaultCategory()); // Set your default category
    SKWEBSHOP.getStorage();
});
</script>
</html>